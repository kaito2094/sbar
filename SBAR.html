<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SBAR Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      background: #f0f2f5;
      margin: 0;
      padding: 0;
    }
    .sidebar {
      height: 100%;
      width: 0;
      position: fixed;
      z-index: 2;
      top: 0;
      left: 0;
      background-color: #1a73e8;
      overflow-x: hidden;
      transition: 0.3s;
      padding-top: 60px;
    }
    .sidebar a {
      padding: 12px 20px;
      text-decoration: none;
      font-size: 18px;
      color: white;
      display: block;
      transition: 0.2s;
    }
    .sidebar a:hover { background-color: #1565c0; }
    .openbtn {
      font-size: 20px;
      cursor: pointer;
      background-color: #1a73e8;
      color: white;
      padding: 10px 15px;
      border: none;
    }
    .navbar {
      background-color: #1a73e8;
      color: white;
      padding: 10px 20px;
      display: flex;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 1;
    }
    .navbar h3 { margin: 0 0 0 10px; }
    .content {
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    .form-group { margin-bottom: 15px; }
    label {
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
    }
    input, select, textarea {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    textarea { height: 60px; resize: vertical; }
    button {
      background-color: #1a73e8;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover { background-color: #145dc3; }
    .section {
      background: white;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 15px;
    }
  </style>
</head>
<body>

<div id="mySidebar" class="sidebar">
  <a href="javascript:void(0)" onclick="closeNav()">‚ùå Close</a>
  <a href="index.html">üè† Home</a>
  <a href="login.html">üîì Logout</a>
</div>

<div class="navbar">
  <button class="openbtn" onclick="openNav()">‚ò∞</button>
  <h3>SBAR Tool</h3>
</div>

<div id="mainContent" class="content">
  <h2>üßæ SBAR Reporting Dashboard</h2>

  <div class="section">
    <h3>1. Work Info</h3>
    <div class="form-group">
      <label for="hospital">Hospital</label>
      <select id="hospital" disabled></select>
    </div>
    <div class="form-group">
      <label for="department">Department</label>
      <select id="department" disabled></select>
    </div>
    <div class="form-group">
      <label for="shift">Shift</label>
      <select id="shift">
        <option></option>
        <option>Morning (6am‚Äì2pm)</option>
        <option>Afternoon (2pm‚Äì10pm)</option>
        <option>Night (10pm‚Äì6am)</option>
        <option>Morning (7am‚Äì3pm)</option>
        <option>Afternoon (3pm‚Äì11pm)</option>
        <option>Night (11pm‚Äì7am)</option>
      </select>
    </div>
  </div>

  <div class="section">
    <h3>2. Patient Information</h3>
    <div class="form-group"><label for="pname">Patient Name</label><input type="text" id="pname"></div>
    <div class="form-group"><label for="page">Patient Age</label><input type="number" id="page"></div>
    <div class="form-group"><label for="diagnosis">Diagnosis</label><input type="text" id="diagnosis"></div>
    <div class="form-group"><label for="room">Room Number</label><input type="text" id="room"></div>
  </div>

  <div class="section">
    <h3>3. SBAR Form</h3>
    <div class="form-group"><label for="situation">Situation</label><textarea id="situation"></textarea></div>
    <div class="form-group"><label for="background">Background</label><textarea id="background"></textarea></div>
    <div class="form-group"><label for="assessment">Assessment</label><textarea id="assessment"></textarea></div>
    <div class="form-group"><label for="recommendation">Recommendation</label><textarea id="recommendation"></textarea></div>
  </div>

  <div class="section">
    <h3>4. Signature & Notes</h3>
    <div class="form-group"><label for="nurse">Reporting Nurse</label><input type="text" id="nurse" readonly></div>
    <div class="form-group"><label for="notes">Shift Notes Summary</label><textarea id="notes"></textarea></div>
    <div class="button-group">
      <button id="submitBtn" onclick="submitSBAR()">Submit SBAR</button>
      <button onclick="window.location.href='patientlist.html'" style="background-color: #34a853;">üë• Patient List</button>
    </div>
  </div>
</div>

<!-- Firebase compat SDK -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCACFjgnRVKjmL-1s68lLpmGNE79xlhBw8",
    authDomain: "sbar-tool.firebaseapp.com",
    projectId: "sbar-tool",
    storageBucket: "sbar-tool.appspot.com",
    messagingSenderId: "529664032389",
    appId: "1:529664032389:web:2cb701c9c684e8618133ec"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const nurse = JSON.parse(sessionStorage.getItem("currentNurse"));
  if (!nurse) {
    alert("Not logged in. Redirecting...");
    window.location.href = "login.html";
  } else {
    document.getElementById("hospital").innerHTML = `<option>${nurse.hospital}</option>`;
    document.getElementById("department").innerHTML = `<option>${nurse.department}</option>`;
    document.getElementById("nurse").value = nurse.fullname;
  }

  const viewPatient = JSON.parse(sessionStorage.getItem("viewPatient"));
  const editPatient = JSON.parse(sessionStorage.getItem("editPatient"));
  let isEditMode = false;
  let editDocId = null;

  if (viewPatient) {
    document.querySelector("h2").textContent = "üëÅÔ∏è Viewing SBAR Report";
    fillForm(viewPatient);
    disableForm();
    document.getElementById("submitBtn").style.display = "none";
    sessionStorage.removeItem("viewPatient");
  } else if (editPatient) {
    document.querySelector("h2").textContent = "‚úèÔ∏è Editing SBAR Report";
    fillForm(editPatient.data);
    isEditMode = true;
    editDocId = editPatient.id;
    document.getElementById("submitBtn").textContent = "üíæ Save Changes";
  }

  function fillForm(data) {
    document.getElementById("shift").value = data.shift || "";
    document.getElementById("pname").value = data.pname || "";
    document.getElementById("page").value = data.page || "";
    document.getElementById("diagnosis").value = data.diagnosis || "";
    document.getElementById("room").value = data.room || "";
    document.getElementById("situation").value = data.situation || "";
    document.getElementById("background").value = data.background || "";
    document.getElementById("assessment").value = data.assessment || "";
    document.getElementById("recommendation").value = data.recommendation || "";
    document.getElementById("notes").value = data.notes || "";
  }

  function disableForm() {
    document.querySelectorAll("input, select, textarea").forEach(el => el.disabled = true);
  }

  async function submitSBAR() {
    const patient = {
      hospital: nurse.hospital,
      department: nurse.department,
      shift: document.getElementById("shift").value,
      pname: document.getElementById("pname").value,
      page: document.getElementById("page").value,
      diagnosis: document.getElementById("diagnosis").value,
      room: document.getElementById("room").value,
      situation: document.getElementById("situation").value,
      background: document.getElementById("background").value,
      assessment: document.getElementById("assessment").value,
      recommendation: document.getElementById("recommendation").value,
      nurse: nurse.fullname,
      notes: document.getElementById("notes").value,
      timestamp: new Date().toISOString()
    };

    try {
      if (isEditMode && editDocId) {
        await db.collection("patients").doc(editDocId).set(patient);
        alert("‚úÖ SBAR report updated.");
      } else {
        await db.collection("patients").add(patient);
        alert("‚úÖ SBAR report submitted.");
      }

      sessionStorage.removeItem("editPatient");
      window.location.href = "patientlist.html";
    } catch (error) {
      console.error("Error saving report:", error);
      alert("‚ùå Failed to save report. Please try again.");
    }
  }

  function openNav() {
    document.getElementById("mySidebar").style.width = "200px";
    document.getElementById("mainContent").style.marginLeft = "200px";
  }

  function closeNav() {
    document.getElementById("mySidebar").style.width = "0";
    document.getElementById("mainContent").style.marginLeft = "0";
  }
</script>

</body>
</html>
